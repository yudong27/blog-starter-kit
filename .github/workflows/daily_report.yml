name: ğŸš€ æ¯æ—¥æˆ˜åœ°è®°è€…æ’­æŠ¥ (Daily Tech Reporter)

on:
  # 1. å®šæ—¶è§¦å‘ï¼šUTC æ—¶é—´æ¯å¤©æ—©ä¸Š 1 ç‚¹ï¼ˆç›¸å½“äºåŒ—äº¬æ—¶é—´æ—©ä¸Š 9 ç‚¹ï¼‰
  schedule:
    - cron: '0 1 * * *'
  # 2. æ‰‹åŠ¨è§¦å‘ï¼šå…è®¸ä½ åœ¨ GitHub ç½‘é¡µä¸Šç‚¹ä¸ªæŒ‰é’®ç«‹åˆ»è¿è¡Œæµ‹è¯•
  workflow_dispatch: 

permissions:
  contents: write

jobs:
  run-reporter:
    runs-on: ubuntu-latest # ä½¿ç”¨æœ€æ–°çš„ Ubuntu æœåŠ¡å™¨

    steps:
    # æ­¥éª¤ 1ï¼šæŠŠä½ çš„ä»£ç æ‹‰å–åˆ°æœåŠ¡å™¨ä¸Š
    - name: ğŸ“¥ æ£€å‡ºä»£ç  (Checkout code)
      uses: actions/checkout@v3

    # æ­¥éª¤ 2ï¼šå®‰è£… Python ç¯å¢ƒ
    - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–åº“ (requests)
    - name: ğŸ“¦ å®‰è£…ä¾èµ– (Install dependencies)
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # æ­¥éª¤ 4ï¼šè¿è¡Œæˆ˜åœ°è®°è€…è„šæœ¬ï¼ã€æ ¸å¿ƒåœ¨è¿™é‡Œã€‘
    - name: ğŸ™ï¸ å¼€å§‹æ’­æŠ¥ (Run Reporter)
      env:
        # è¿™é‡Œå°±æ˜¯æŠŠä¿é™©ç®±é‡Œçš„ Secret æ³¨å…¥æˆäº†ç¯å¢ƒå˜é‡
        DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
        # ğŸ‘‡ æ–°å¢è¿™ä¸‰è¡Œæ³¨å…¥é‚®ç®±ç¯å¢ƒå˜é‡
        EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}
      run: |
        bash run_github.sh

    # âš ï¸ æ–°å¢æ ¸å¿ƒæ­¥éª¤ï¼šå°†æ–°ç”Ÿæˆçš„ Markdown æ–‡ä»¶ Commit å¹¶ Push åˆ°ä»“åº“
    - name: ğŸ’¾ è‡ªåŠ¨æäº¤åˆ° GitHub ä»“åº“
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"
        # æ·»åŠ æ‰€æœ‰æ–°ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆæ¯”å¦‚ _posts ç›®å½•ä¸‹çš„æ–° mdï¼‰
        git add _posts/ -f
        # æ£€æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶æ”¹åŠ¨ï¼Œå¦‚æœæœ‰å°± commit å¹¶ push
        if git diff --staged --quiet; then
          echo "ä»Šå¤©æ²¡æœ‰æ–°æˆ˜æŠ¥ï¼Œæ— éœ€æäº¤"
        else
          git commit -m "ğŸ“ Auto-publish: $(date +'%Y-%m-%d') æˆ˜åœ°å¿«æŠ¥"
          git push
        fi